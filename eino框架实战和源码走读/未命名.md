


eino框架对工具的抽象封装提供了以下主要结构体和接口：

## 核心接口

**BaseTool接口** - 所有工具的基础接口，提供获取工具信息的能力：
**InvokableTool接口** - 可调用工具接口，继承BaseTool并提供同步执行能力： 
**StreamableTool接口** - 流式工具接口，继承BaseTool并提供流式执行能力：

``` Go
package tool
// BaseTool 用于获取 ChatModel 意图识别工具的信息
type BaseTool interface {
	// Info 返回工具的详细信息，具体见 schema.ToolInfo 定义
	Info(ctx context.Context) (*schema.ToolInfo, error)
}

// InvokableTool 用于 ChatModel 意图识别和 ToolsNode 执行的工具接口
// nolint: byted_s_interface_name
type InvokableTool interface {
	BaseTool

	// InvokableRun 接收 JSON 格式的参数，并执行工具函数
	InvokableRun(ctx context.Context, argumentsInJSON string, opts ...Option) (string, error)
}

// StreamableTool 用于 ChatModel 意图识别和 ToolsNode 执行的流式工具接口
// nolint: byted_s_interface_name
type StreamableTool interface {
	BaseTool

	// StreamableRun 接收 JSON 格式的参数，返回一个流式读取器以便持续读取结果
	StreamableRun(ctx context.Context, argumentsInJSON string, opts ...Option) (*schema.StreamReader[string], error)
}
```

## 工具信息相关结构体

**ToolInfo结构体** - 定义工具的基本信息，包括名称、描述和参数：
**ParameterInfo结构体** - 描述工具参数的详细信息：
**ParamsOneOf结构体** - 工具参数定义的联合体，支持两种参数描述方式： 

``` Go
package schema

// 定义参数类型，用于描述参数的数据类型，必须是 OpenAPI v3.0 中对应的类型之一
// 可选值包括："object", "number", "integer", "string", "array", "null", "boolean"
type DataType string

const (
	// 对象类型，对应 JSON 中的 object 类型
	Object DataType = "object"
	// 数字类型，对应 JSON 中的 number 类型
	Number DataType = "number"
	// 整数类型，对应 JSON 中的 integer 类型
	Integer DataType = "integer"
	// 字符串类型，对应 JSON 中的 string 类型
		String DataType = "string"
	// 数组类型，对应 JSON 中的 array 类型
	Array DataType = "array"
	// 空值类型，对应 JSON 中的 null 类型
	Null DataType = "null"
	// 布尔值类型，对应 JSON 中的 boolean 类型
	Boolean DataType = "boolean"
)

// ToolChoice 控制模型调用工具的方式，针对工具调用的策略
type ToolChoice string

const (
	// ToolChoiceForbidden 表示模型不调用任何工具，对应 OpenAI Chat Completion 中的 "none"
	ToolChoiceForbidden ToolChoice = "forbidden"
	
	// ToolChoiceAllowed 表示模型可以选择生成消息或者调用一个或多个工具，对应 "auto"
	ToolChoiceAllowed ToolChoice = "allowed"

	// ToolChoiceForced 表示模型必须调用一个或多个工具，对应 "required"
	ToolChoiceForced ToolChoice = "forced"
)

// ToolInfo 用于描述工具的信息，主要用于模型的意图识别和工具调用
type ToolInfo struct {
	// Name 为工具的唯一名称，用于清晰地表达工具的目的
	Name string
	// Desc 用于说明工具的使用场景，包括如何、何时以及为什么使用该工具
	// 可在描述中提供少量示例以帮助模型理解如何调用
	Desc string
	// *ParamsOneOf 为工具所需要的参数描述，可以有两种方式构造：
	// 1. 使用 params：schema.NewParamsOneOfByParams(params)
	// 2. 使用 openAPIV3：schema.NewParamsOneOfByOpenAPIV3(openAPIV3)
	// 如果该值为 nil，则表示工具不需要任何输入参数
	*ParamsOneOf
}

// ParameterInfo 描述工具中单个参数的信息
type ParameterInfo struct {
	// Type 表示参数的数据类型，取值为 DataType 的枚举值
	Type DataType
	// ElemInfo 仅用于数组类型，表示数组内元素的类型信息
	ElemInfo *ParameterInfo
	// SubParams 仅用于对象类型，表示对象内各个子参数的详细描述，存储为键值对
	SubParams map[string]*ParameterInfo
	// Desc 为参数的详细描述信息
	Desc string
	// Enum 针对字符串类型参数，表示可选的枚举值列表
	Enum []string
	// Required 表示参数是否为必选项
	Required bool
}

// ParamsOneOf 用于描述工具请求参数时提供的两种方式的联合体。
// 用户必须选择其中一种方式来描述工具的请求参数：
//  1. 使用 NewParamsOneOfByParams()：一种直观、适用于大多数场景的描述方式。
//  2. 使用 NewParamsOneOfByOpenAPIV3()：一种严格遵循 OpenAPI v3.0 规范的描述方式。
// 详情参考：https://github.com/getkin/kin-openapi/blob/master/openapi3/schema.go
type ParamsOneOf struct {
	// 当使用 NewParamsOneOfByParams 设置时，params 存储参数信息的映射表，键为参数名称
	params map[string]*ParameterInfo

	// 当使用 NewParamsOneOfByOpenAPIV3 设置时，openAPIV3 保存一个 OpenAPI v3.0 schema 描述
	openAPIV3 *openapi3.Schema
}


```

## 工具选项配置

**Option结构体** - 工具调用时的选项配置：
**toolOptions结构体** - 工具创建时的内部选项配置： 

``` Go
package tool  
  
// Option 用于定义 InvokableTool 或 StreamableTool 组件调用的选项，  
// 每个工具实现可以在自己包内定义特定的选项结构体和选项函数，  
// 然后通过该类型将工具实现特有的选项函数包装为统一的 Option 类型，  
// 在调用 InvokableRun 或 StreamableRun 时传入。  
type Option struct {  
    // implSpecificOptFn 存储工具实现特定的选项函数，类型为 any，  
    // 不同工具可以根据自身需求定义对应结构体类型。  
    implSpecificOptFn any  
}  
  
// WrapImplSpecificOptFn 将工具实现特定的选项函数包装为统一的 Option 类型。  
// 参数 T 指定工具实现选项结构体的类型。  
// 工具实现者需要通过该函数将自己的选项函数转换为 Option 类型。  
// 例如，如果工具定义了自己的选项结构体：  
//  
//  type customOptions struct {  
//      conf string  
//  }  
//  
// 则可以提供如下选项函数：  
//  
//  func WithConf(conf string) Option {  
//      return WrapImplSpecificOptFn(func(o *customOptions) {  
//         o.conf = conf  
//      })  
//  }  
//  
// 通过 WrapImplSpecificOptFn 函数，工具可以将自定义的选项逻辑包装成统一格式，方便后续解析使用。  
func WrapImplSpecificOptFn[T any](optFn func(*T)) Option {  
    return Option{  
       implSpecificOptFn: optFn,  
    }  
}  
  
// GetImplSpecificOptions 用于在工具实现的 InvokableRun 或 StreamableRun 函数中，  
// 从统一的 Option 集合中提取工具实现特定的选项设置，并应用到对应的选项结构体中。  
// 参数 T 为工具实现选项结构体的类型，base 为包含默认值的选项实例。  
// 该函数会遍历传入的 Option 列表，如果 Option 内包含特定类型的选项函数，  
// 则调用该选项函数将对应的设置应用到 base 中，最终返回更新后的选项实例。  
// 示例用法：  
//  
//  type customOptions struct {  
//      conf string  
//  }  
//  defaultOptions := &customOptions{}  
//  finalOptions := GetImplSpecificOptions(defaultOptions, opts...)  
//  
// 这样工具实现可以在默认值的基础上，根据用户传入的选项调整内部配置。  
func GetImplSpecificOptions[T any](base *T, opts ...Option) *T {  
    // 如果传入的 base 为 nil，则创建一个新实例  
    if base == nil {  
       base = new(T)  
    }  
  
    // 遍历所有 Option，检查并调用封装的选项函数  
    for i := range opts {  
       opt := opts[i]  
       if opt.implSpecificOptFn != nil {  
          // 尝试将 implSpecificOptFn 转换为期望的函数类型 func(*T)          optFn, ok := opt.implSpecificOptFn.(func(*T))  
          if ok {  
             // 应用选项函数到 base 上，更新选项配置  
             optFn(base)  
          }  
       }  
    }  
  
    return base  
}
```

## 工具实现结构体

**invokableTool[T, D]结构体** - 泛型可调用工具的具体实现： [9](#0-8) 

**streamableTool[T, D]结构体** - 泛型流式工具的具体实现： [10](#0-9) 

## 工具节点相关

**ToolsNode结构体** - 在图中执行工具的节点： [11](#0-10) 

**ToolsNodeConfig结构体** - 工具节点的配置： [12](#0-11) 

**toolsNodeOptions结构体** - 工具节点的选项配置： [13](#0-12) 

## 函数类型定义

**InvokeFunc[T, D]类型** - 可调用工具函数的类型定义： [14](#0-13) 

**StreamFunc[T, D]类型** - 流式工具函数的类型定义： [15](#0-14) 

## Notes

eino框架采用了分层的接口设计，BaseTool作为基础，InvokableTool和StreamableTool分别扩展同步和异步执行能力。框架使用Go泛型提供类型安全，通过工具实用函数支持从普通Go函数创建工具。工具通过ToolsNode集成到执行框架中，支持并行执行。系统还通过选项模式支持自定义序列化/反序列化和运行时配置。

