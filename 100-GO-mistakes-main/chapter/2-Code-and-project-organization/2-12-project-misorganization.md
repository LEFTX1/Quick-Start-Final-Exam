## 2.12 项目组织不善

组织 Go 项目并非易事。由于 Go 语言在设计软件包和模块方面提供了很大的自由，因此最佳实践并不像应该的那样无处不在。本节将首先深入研究构建项目的常见方法，然后讨论一些最佳实践，展示如何改进我们组织项目的方式。

### 2.12.1 项目结构

语言维护者没有给在Go中构建项目带来强烈的惯例。然而，这些年出现了一种布局： [github.com/golang-standards/project-layout](https://github.com/golang-standards/project-layout) 。

如果您的项目足够小（只有几个文件），或者您的组织已经创建了其标准，则可能不值得使用或迁移到 `project-layout`。否则，可能值得考虑。让我们深入研究一下这个布局，看看主要目录是什么：
* `/cmd`:主要源文件。`Foo` 应用程序的 `main.go` 应该位于 `/cmd/foo/main.go` 中。
* `/internal`: 我们不希望其他人在其应用程序或库中导入的私人代码。
* `/pkg`:我们希望向他人公开的公共代码。
* `/test`:其他外部测试和测试数据。Go 中的单元测试在与源文件相同的软件包中上线。然而，公共 API 或集成测试等测试应该存在于 `/test` 中。
* `/configs`:配置文件
* `/docs`:设计和用户文档
* `/examples`:我们的应用程序或者公共类库的例子。
* `/api`:API合同文件（例如，Swagger，Protocol Buffers，等等）。
* `web`:Web应用程序特定文件(静态文件等)。
* `/scripts`:分析脚本和安装脚本等。
* `/vendor`:依赖的应用程序（Go 的依赖包等）。

没有 `/src` 目录，就像其他一些语言一样。理由是 `/src` 过于通用；因此，这种布局倾向于 `/cmd`  `/internal` 或 `/pkg` 等目录。

> **Note** 2021年，Go 的核心维护者之一 Russ Cox 对这种布局提出了一些批评。主要是因为这个项目属于 Github `golang-standards` 组织，尽管不是官方标准。无论如何，我们必须记住，关于项目结构，没有强制性惯例。这种布局可能对你有帮助或没有帮助，但重要的是，优柔寡断是唯一错误的决定。因此，商定一个布局，以保持组织内部的一致性，以便开发人员不会浪费时间从一个回购协议切换到另一个回购协议。

现在，让我们讨论如何组织 Go 存储库的主要逻辑。

### 2.12.2 包规划

在Go项目中，没有子包的概念。但是，我们可以决定在子目录中组织软件包。如果我们看看标准库，`net` 目录是这样组织的：

```go
/net
    /http
        client.go
        ...
    /smtp
        auth.go
        ...
    addrselect.go
    ...
```

`net` 既充当软件包，也充当包含其他软件包的目录。然而，`net/http` 没有从 `net` 继承，也没有对 `net` 包的特定访问权。`net/http` 内部的元素只能看到导出的 `net` 元素。子目录的主要好处是使软件包保持高内聚。

关于整体组织，有不同的思想流派。例如，我们应该按上下文还是按层组织我们的应用程序？这取决于我们的喜好。人们可能倾向于按上下文对代码进行分组（例如，客户上下文、合同上下文），您可能倾向于遵循六边形架构原则和每个技术层分组。如果我们做出的决定符合我们的用例，只要我们与它保持一致，它就不可能是一个错误的决定。让我们记住，唯一错误的决定就是没有决定。

关于软件包，我们应该遵循多种最佳实践。

首先，我们应该避免过早包装，因为这可能会导致我们使项目过于复杂化。有时，最好保持一个简单的组织，当我们了解项目包含的内容时，让我们的项目不断发展，而不是强迫自己提前拥有完美的结构。

粒度是另一件需要考虑的重要事情。我们应该避免拥有数十个仅包含一两个文件的微型软件包。如果我们这样做了，那是因为我们可能错过了这些软件包之间的一些逻辑联系，这使得读者更难理解我们的项目。相反，我们也应该避免稀释软件包名称含义的巨大软件包。

包命名也应该小心。作为开发人员，我们都知道，命名很难。为了帮助 client 了解 Go 项目，我们应该以他们提供的内容命名包，而不是他们包含的内容。此外，命名应该是有意义的。因此，包名称应该简短、简洁、富有表现力。此外，按照惯例，小写和单字名称。

关于对外返回值，规则应该非常简单。我们应该尽可能减少应该对外返回值，以减少软件包之间的耦合，并隐藏不必要的返回值。如果我们不确定是否返回的元素，我们应该默认不返回它。稍后，如果我们发现我们需要返回它，我们可以调整代码。让我们也记住一些例外情况，例如返回字段，以便将结构解封为 `encoding/json`。

组织一个项目并不简单，如果我们遵循这些规则，它应该有助于我们更容易维护。然而，让我们记住，一致性对于简化可维护性也至关重要。因此，让我们确保在代码库中尽可能保持一致。

在下一节中，我们将处理公用包。